<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Quiz Projector</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        .quiz-container {
            height: 100%;
            padding: 10px;
            margin: 0;
            max-width: 100%;
        }
        #start-screen {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        #subject-selection, #chapter-selection, #question-count-selection {
            max-height: 60vh;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
        #quiz-screen, #results-screen {
            height: 100%;
            display: none;
            overflow-y: auto;
        }
        .option {
            padding: 15px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .option:hover {
            background-color: #f1f1f1;
        }
        .option-letter {
            font-weight: bold;
            margin-right: 15px;
            min-width: 25px;
            font-size: 1.2rem;
        }
        .correct-answer {
            background-color: #d4edda;
            border-color: #c3e6cb;
            font-weight: bold;
        }
        .question-text {
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .malayalam-text {
            font-family: 'Noto Sans Malayalam', sans-serif;
        }
        .question-image {
            max-height: 250px;
            cursor: zoom-in;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .question-image.zoomed {
            transform: scale(2);
            cursor: zoom-out;
            z-index: 100;
            position: relative;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        .timer {
            font-size: 1.3rem;
            font-weight: bold;
            margin-right: 20px;
        }
        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .answer-item {
            margin-bottom: 20px;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .time-taken {
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }
        .font-size-control {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .font-size-slider {
            width: 180px;
        }
        .subject-btn {
            margin: 5px;
            padding: 10px 15px;
            width: 200px;
        }
        .chapter-item {
            margin-bottom: 10px;
        }
        .question-count-select {
            width: 80px;
            display: inline-block;
            margin-left: 10px;
        }
        .nav-buttons {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 10px;
            border-top: 1px solid #ddd;
            z-index: 100;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Malayalam&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container-fluid quiz-container">
        <!-- Start Screen -->
        <div id="start-screen" class="text-center">
            <h1 class="mb-4">Classroom Quiz Projector</h1>
            
            <div id="subject-selection" class="mb-4">
                <h4 class="mb-3">Select Test Type:</h4>
                <button id="all-subjects-btn" class="btn btn-primary subject-btn">All Subjects</button>
                <button id="part1-malayalam-btn" class="btn btn-secondary subject-btn">Part I Malayalam</button>
                <button id="part2-malayalam-btn" class="btn btn-secondary subject-btn">Part II Malayalam</button>
                <button id="maths-btn" class="btn btn-secondary subject-btn">Maths</button>
                <button id="english-btn" class="btn btn-secondary subject-btn">English</button>
                <button id="basic-science-btn" class="btn btn-secondary subject-btn">Basic Science</button>
                <button id="social-science-btn" class="btn btn-secondary subject-btn">Social Science</button>
            </div>
            
            <div id="chapter-selection" class="mb-4" style="display: none;">
                <h4 class="mb-3">Select Chapters:</h4>
                <!-- Chapters will be populated by JavaScript -->
            </div>
            
            <div id="question-count-selection" class="mb-4" style="display: none;">
                <h4 class="mb-3">Select Number of Questions:</h4>
                <div class="d-flex justify-content-center">
                    <button class="btn btn-outline-primary question-count-btn" data-count="5">5</button>
                    <button class="btn btn-outline-primary question-count-btn mx-2" data-count="10">10</button>
                    <button class="btn btn-outline-primary question-count-btn" data-count="15">15</button>
                    <button class="btn btn-outline-primary question-count-btn mx-2" data-count="20">20</button>
                    <button class="btn btn-outline-primary question-count-btn" data-count="25">25</button>
                </div>
            </div>
            
            <button id="start-quiz-btn" class="btn btn-success btn-lg" style="display: none;">Start Quiz</button>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen">
            <div class="quiz-header">
                <div>
                    <span id="question-counter" class="fw-bold"></span>
                    <span id="subject-display" class="badge bg-secondary ms-2"></span>
                    <span id="chapter-display" class="badge bg-info ms-1"></span>
                </div>
                <div class="d-flex align-items-center">
                    <span id="timer" class="timer">00:00</span>
                    <button id="language-toggle" class="btn btn-sm btn-outline-secondary">മലയാളം</button>
                </div>
            </div>
            
            <div class="card mb-3">
                <div class="card-body p-4">
                    <div id="question-text" class="question-text"></div>
                    <div id="question-image-container" class="text-center"></div>
                </div>
            </div>
            
            <div id="options-container" class="mb-5">
                <!-- Options will be inserted here -->
            </div>
            
            <!-- Font Size Control -->
            <div class="font-size-control">
                <div class="d-flex align-items-center mb-2">
                    <small class="me-2">A</small>
                    <input type="range" id="font-size-slider" class="form-range font-size-slider" min="1" max="5" step="0.5" value="3">
                    <small class="ms-2">A</small>
                </div>
                <small class="text-muted">Adjust Font Size</small>
            </div>
            
            <div class="nav-buttons d-flex justify-content-between">
                <button id="prev-btn" class="btn btn-secondary">Previous</button>
                <button id="reveal-btn" class="btn btn-warning">Reveal Answer</button>
                <button id="next-btn" class="btn btn-primary">Next</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Quiz Results</h2>
                <button id="results-language-toggle" class="btn btn-sm btn-outline-secondary">മലയാളം</button>
            </div>
            
            <div id="time-taken" class="time-taken"></div>
            <div id="answers-container"></div>
            
            <div class="nav-buttons text-center">
                <button id="restart-btn" class="btn btn-primary">Restart Quiz</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const startScreen = document.getElementById('start-screen');
            const quizScreen = document.getElementById('quiz-screen');
            const resultsScreen = document.getElementById('results-screen');
            const subjectSelection = document.getElementById('subject-selection');
            const chapterSelection = document.getElementById('chapter-selection');
            const questionCountSelection = document.getElementById('question-count-selection');
            const startQuizBtn = document.getElementById('start-quiz-btn');
            const allSubjectsBtn = document.getElementById('all-subjects-btn');
            const subjectButtons = [
                document.getElementById('part1-malayalam-btn'),
                document.getElementById('part2-malayalam-btn'),
                document.getElementById('maths-btn'),
                document.getElementById('english-btn'),
                document.getElementById('basic-science-btn'),
                document.getElementById('social-science-btn')
            ];
            const questionCountButtons = document.querySelectorAll('.question-count-btn');
            const nextBtn = document.getElementById('next-btn');
            const prevBtn = document.getElementById('prev-btn');
            const revealBtn = document.getElementById('reveal-btn');
            const restartBtn = document.getElementById('restart-btn');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const questionCounter = document.getElementById('question-counter');
            const subjectDisplay = document.getElementById('subject-display');
            const chapterDisplay = document.getElementById('chapter-display');
            const languageToggle = document.getElementById('language-toggle');
            const resultsLanguageToggle = document.getElementById('results-language-toggle');
            const questionImageContainer = document.getElementById('question-image-container');
            const answersContainer = document.getElementById('answers-container');
            const timerDisplay = document.getElementById('timer');
            const timeTakenDisplay = document.getElementById('time-taken');
            const fontSizeSlider = document.getElementById('font-size-slider');

            // Quiz variables
            let questions = [];
            let currentQuestionIndex = 0;
            let selectedQuestions = [];
            let answerRevealed = false;
            let selectedChapters = [];
            let selectedSubject = null;
            let questionsPerChapter = 0;
            let currentLanguage = 'english';
            let startTime;
            let timerInterval;
            const optionLetters = ['A', 'B', 'C', 'D'];
            
            // Font size variables
            let questionFontSize = 1.8;
            let optionFontSize = 1.5;

            // Initialize the app
            loadQuestions();

            // Load questions from JSON file
            async function loadQuestions() {
                try {
                    const response = await fetch('questions.json');
                    if (!response.ok) throw new Error('Failed to load questions');
                    questions = await response.json();
                    
                    // Load settings
                    loadSettings();
                } catch (error) {
                    console.error('Error loading questions:', error);
                    alert('Failed to load questions. Please try again later.');
                }
            }

            // Load saved settings from localStorage
            function loadSettings() {
                // Language
                const savedLanguage = localStorage.getItem('quizLanguage');
                if (savedLanguage) {
                    currentLanguage = savedLanguage;
                    updateLanguageButtonText();
                }
                
                // Font sizes
                const savedQuestionSize = localStorage.getItem('questionFontSize');
                const savedOptionSize = localStorage.getItem('optionFontSize');
                if (savedQuestionSize) questionFontSize = parseFloat(savedQuestionSize);
                if (savedOptionSize) optionFontSize = parseFloat(savedOptionSize);
                
                // Set initial slider value
                fontSizeSlider.value = ((questionFontSize + optionFontSize) / 2).toFixed(1);
            }

            // Update language toggle button text
            function updateLanguageButtonText() {
                languageToggle.textContent = currentLanguage === 'english' ? 'മലയാളം' : 'English';
                if (resultsLanguageToggle) {
                    resultsLanguageToggle.textContent = currentLanguage === 'english' ? 'മലയാളം' : 'English';
                }
            }

            // Event listeners for subject selection
            allSubjectsBtn.addEventListener('click', function() {
                selectedSubject = null;
                showChapterSelection(true);
                questionCountSelection.style.display = 'none';
            });

            subjectButtons.forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    selectedSubject = [
                        "Part I Malayalam",
                        "Part II Malayalam",
                        "Maths",
                        "English",
                        "Basic Science",
                        "Social Science"
                    ][index];
                    showChapterSelection(false);
                    questionCountSelection.style.display = 'block';
                });
            });

            // Event listeners for question count selection
            questionCountButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    questionsPerChapter = parseInt(btn.dataset.count);
                    questionCountButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    startQuizBtn.style.display = 'inline-block';
                });
            });

            // Show chapter selection
            function showChapterSelection(isAllSubjects) {
                chapterSelection.innerHTML = '<h4 class="mb-3">Select Chapters:</h4>';
                
                // Get unique chapters based on selection
                let chapters;
                if (isAllSubjects) {
                    chapters = [...new Set(questions.map(q => q.chapter))];
                } else {
                    chapters = [...new Set(questions.filter(q => q.subject === selectedSubject).map(q => q.chapter))];
                }
                
                chapters.sort((a, b) => a - b);
                
                if (chapters.length === 0) {
                    chapterSelection.innerHTML = '<p>No chapters found for selected subject.</p>';
                    return;
                }
                
                // Create checkboxes for each chapter
                chapters.forEach(chapter => {
                    const div = document.createElement('div');
                    div.className = 'form-check chapter-item';
                    
                    const input = document.createElement('input');
                    input.className = 'form-check-input chapter-checkbox';
                    input.type = 'checkbox';
                    input.value = chapter;
                    input.id = `chapter-${chapter}`;
                    input.checked = true;
                    
                    const label = document.createElement('label');
                    label.className = 'form-check-label';
                    label.htmlFor = input.id;
                    label.textContent = `Chapter ${chapter}`;
                    
                    div.appendChild(input);
                    div.appendChild(label);
                    chapterSelection.appendChild(div);
                });
                
                chapterSelection.style.display = 'block';
                startQuizBtn.style.display = 'inline-block';
            }

            // Start the quiz
            startQuizBtn.addEventListener('click', function() {
                selectedChapters = Array.from(document.querySelectorAll('.chapter-checkbox:checked')).map(cb => parseInt(cb.value));
                
                if (selectedChapters.length === 0) {
                    alert('Please select at least one chapter');
                    return;
                }
                
                // Start timer
                startTime = new Date();
                timerInterval = setInterval(updateTimer, 1000);
                updateTimer();
                
                // Initialize quiz
                currentQuestionIndex = 0;
                answerRevealed = false;
                selectedQuestions = selectQuestions();
                
                if (selectedQuestions.length === 0) {
                    alert('No questions found for selected criteria');
                    return;
                }
                
                // Show quiz screen
                startScreen.style.display = 'none';
                resultsScreen.style.display = 'none';
                quizScreen.style.display = 'block';
                
                loadQuestion();
            });

            // Select questions based on current selection
            function selectQuestions() {
                let filteredQuestions = [];
                
                if (selectedSubject) {
                    // For specific subject
                    filteredQuestions = questions.filter(q => 
                        q.subject === selectedSubject && selectedChapters.includes(q.chapter)
                    );
                    
                    // Group by chapter and select requested number of questions
                    let selected = [];
                    selectedChapters.forEach(chapter => {
                        const chapterQuestions = filteredQuestions.filter(q => q.chapter === chapter);
                        const shuffled = shuffleArray(chapterQuestions);
                        selected.push(...shuffled.slice(0, Math.min(questionsPerChapter, shuffled.length)));
                    });
                    
                    return shuffleArray(selected);
                } else {
                    // For all subjects
                    filteredQuestions = questions.filter(q => selectedChapters.includes(q.chapter));
                    
                    // Group by subject with default counts
                    const part1Malayalam = getRandomElements(filteredQuestions.filter(q => q.subject === "Part I Malayalam"), 5);
                    const part2Malayalam = getRandomElements(filteredQuestions.filter(q => q.subject === "Part II Malayalam"), 5);
                    const maths = getRandomElements(filteredQuestions.filter(q => q.subject === "Maths"), 10);
                    const english = getRandomElements(filteredQuestions.filter(q => q.subject === "English"), 5);
                    const basicScience = getRandomElements(filteredQuestions.filter(q => q.subject === "Basic Science"), 10);
                    const socialScience = getRandomElements(filteredQuestions.filter(q => q.subject === "Social Science"), 10);
                    
                    return shuffleArray([
                        ...part1Malayalam,
                        ...part2Malayalam,
                        ...maths,
                        ...english,
                        ...basicScience,
                        ...socialScience
                    ].filter(q => q !== undefined));
                }
            }

            // Shuffle array
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }

            // Get random elements from array
            function getRandomElements(array, count) {
                if (array.length === 0) return [];
                const shuffled = shuffleArray(array);
                return shuffled.slice(0, Math.min(count, shuffled.length));
            }

            // Update timer display
            function updateTimer() {
                const now = new Date();
                const elapsed = new Date(now - startTime);
                const minutes = elapsed.getUTCMinutes().toString().padStart(2, '0');
                const seconds = elapsed.getUTCSeconds().toString().padStart(2, '0');
                timerDisplay.textContent = `${minutes}:${seconds}`;
            }

            // Format time taken for display
            function formatTimeTaken(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                return `${minutes} minute${minutes !== 1 ? 's' : ''} ${seconds} second${seconds !== 1 ? 's' : ''}`;
            }

            // Load and display current question
            function loadQuestion() {
                answerRevealed = false;
                const question = selectedQuestions[currentQuestionIndex];
                
                // Update question counter and subject info
                questionCounter.textContent = `Q${currentQuestionIndex + 1}/${selectedQuestions.length}`;
                subjectDisplay.textContent = question.subject;
                chapterDisplay.textContent = `Chapter ${question.chapter}`;
                
                // Set question text
                if (currentLanguage === 'malayalam' && question.malayalam_question) {
                    questionText.textContent = question.malayalam_question;
                    questionText.classList.add('malayalam-text');
                } else {
                    questionText.textContent = question.question;
                    questionText.classList.remove('malayalam-text');
                }
                
                // Apply current font size
                questionText.style.fontSize = `${questionFontSize}rem`;
                questionText.style.lineHeight = `${questionFontSize + 0.5}rem`;
                
                // Display question image if exists
                displayQuestionImage(question.image);
                
                // Create options with A, B, C, D labels (shuffled)
                optionsContainer.innerHTML = '';
                const options = [
                    { text: question.option1, malayalam: question.malayalam_option1, isCorrect: question.answer === question.option1 },
                    { text: question.option2, malayalam: question.malayalam_option2, isCorrect: question.answer === question.option2 },
                    { text: question.option3, malayalam: question.malayalam_option3, isCorrect: question.answer === question.option3 },
                    { text: question.option4, malayalam: question.malayalam_option4, isCorrect: question.answer === question.option4 }
                ];
                
                // Shuffle options but keep track of correct answer
                const shuffledOptions = shuffleArray(options);
                
                shuffledOptions.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.dataset.index = index;
                    optionDiv.dataset.correct = option.isCorrect;
                    
                    const optionLetter = document.createElement('div');
                    optionLetter.className = 'option-letter';
                    optionLetter.textContent = optionLetters[index];
                    optionLetter.style.fontSize = `${optionFontSize}rem`;
                    
                    const optionContent = document.createElement('div');
                    optionContent.className = 'option-content';
                    optionContent.style.fontSize = `${optionFontSize}rem`;
                    optionContent.style.lineHeight = `${optionFontSize + 0.3}rem`;
                    
                    if (currentLanguage === 'malayalam' && option.malayalam) {
                        optionContent.textContent = option.malayalam;
                        optionContent.classList.add('malayalam-text');
                    } else {
                        optionContent.textContent = option.text;
                        optionContent.classList.remove('malayalam-text');
                    }
                    
                    optionDiv.appendChild(optionLetter);
                    optionDiv.appendChild(optionContent);
                    optionsContainer.appendChild(optionDiv);
                    
                    // Add click event to select option
                    optionDiv.addEventListener('click', function() {
                        if (answerRevealed) return;
                        document.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        this.classList.add('selected');
                    });
                });
                
                // Update navigation buttons
                prevBtn.classList.toggle('d-none', currentQuestionIndex === 0);
                nextBtn.textContent = currentQuestionIndex === selectedQuestions.length - 1 ? 'Finish' : 'Next';
                revealBtn.textContent = 'Reveal Answer';
                revealBtn.disabled = false;
                
                // Scroll to top of question
                window.scrollTo(0, 0);
            }

            // Display question image with zoom functionality
            function displayQuestionImage(imagePath) {
                questionImageContainer.innerHTML = '';
                
                if (imagePath) {
                    const img = document.createElement('img');
                    img.src = imagePath;
                    img.alt = "Question image";
                    img.className = "question-image img-fluid rounded";
                    
                    // Add zoom functionality
                    img.addEventListener('click', function() {
                        this.classList.toggle('zoomed');
                    });
                    
                    questionImageContainer.appendChild(img);
                    questionImageContainer.style.display = 'block';
                } else {
                    questionImageContainer.style.display = 'none';
                }
            }

            // Font size adjustment functions
            function updateFontSizes() {
                // Calculate new sizes based on slider position (1-5)
                const sliderValue = parseFloat(fontSizeSlider.value);
                questionFontSize = 1.0 + (sliderValue * 0.8); // 1.0-5.0rem (wider range for projector)
                optionFontSize = 0.9 + (sliderValue * 0.7);   // 0.9-4.4rem
                
                // Save to localStorage
                localStorage.setItem('questionFontSize', questionFontSize);
                localStorage.setItem('optionFontSize', optionFontSize);
                
                // Apply to current elements
                applyFontSizes();
            }

            function applyFontSizes() {
                // Apply to question text
                if (questionText) {
                    questionText.style.fontSize = `${questionFontSize}rem`;
                    questionText.style.lineHeight = `${questionFontSize + 0.5}rem`;
                }
                
                // Apply to options
                const optionContents = document.querySelectorAll('.option-content');
                optionContents.forEach(option => {
                    option.style.fontSize = `${optionFontSize}rem`;
                    option.style.lineHeight = `${optionFontSize + 0.3}rem`;
                });
                
                // Apply to current results if on results screen
                if (resultsScreen.style.display === 'block') {
                    const answerQuestions = answersContainer.querySelectorAll('.answer-item .fw-bold');
                    answerQuestions.forEach(q => {
                        q.style.fontSize = `${questionFontSize}rem`;
                        q.style.lineHeight = `${questionFontSize + 0.5}rem`;
                    });
                    
                    const answerOptions = answersContainer.querySelectorAll('.answer-item div:not(.fw-bold)');
                    answerOptions.forEach(opt => {
                        opt.style.fontSize = `${optionFontSize}rem`;
                        opt.style.lineHeight = `${optionFontSize + 0.3}rem`;
                    });
                }
            }

            // Toggle between English and Malayalam
            function toggleLanguage() {
                currentLanguage = currentLanguage === 'english' ? 'malayalam' : 'english';
                localStorage.setItem('quizLanguage', currentLanguage);
                updateLanguageButtonText();
                updateQuestionLanguage();
            }

            // Toggle language for results screen
            function toggleResultsLanguage() {
                currentLanguage = currentLanguage === 'english' ? 'malayalam' : 'english';
                localStorage.setItem('quizLanguage', currentLanguage);
                updateLanguageButtonText();
                showResults();
            }

            // Update question language
            function updateQuestionLanguage() {
                const question = selectedQuestions[currentQuestionIndex];
                
                // Update question text
                if (currentLanguage === 'malayalam' && question.malayalam_question) {
                    questionText.textContent = question.malayalam_question;
                    questionText.classList.add('malayalam-text');
                } else {
                    questionText.textContent = question.question;
                    questionText.classList.remove('malayalam-text');
                }
                
                // Update options
                const options = document.querySelectorAll('.option-content');
                options.forEach((option, index) => {
                    const optionData = selectedQuestions[currentQuestionIndex];
                    let optionText;
                    
                    if (currentLanguage === 'malayalam') {
                        optionText = optionData[`malayalam_option${index + 1}`] || optionData[`option${index + 1}`];
                        option.textContent = optionText;
                        if (optionData[`malayalam_option${index + 1}`]) {
                            option.classList.add('malayalam-text');
                        } else {
                            option.classList.remove('malayalam-text');
                        }
                    } else {
                        option.textContent = optionData[`option${index + 1}`];
                        option.classList.remove('malayalam-text');
                    }
                });
            }

            // Reveal the correct answer
            function revealAnswer() {
                answerRevealed = true;
                const options = document.querySelectorAll('.option');
                
                options.forEach(option => {
                    if (option.dataset.correct === 'true') {
                        option.classList.add('correct-answer');
                    }
                });
                
                revealBtn.textContent = 'Answer Revealed';
                revealBtn.disabled = true;
            }

            // Move to next question
            function nextQuestion() {
                if (currentQuestionIndex < selectedQuestions.length - 1) {
                    currentQuestionIndex++;
                    loadQuestion();
                } else {
                    showResults();
                }
            }

            // Move to previous question
            function prevQuestion() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    loadQuestion();
                }
            }

            // Show results screen
            function showResults() {
                // Stop timer
                clearInterval(timerInterval);
                const endTime = new Date();
                const timeTaken = endTime - startTime;
                
                // Show time taken
                timeTakenDisplay.textContent = `Time taken: ${formatTimeTaken(timeTaken)}`;
                timeTakenDisplay.style.fontSize = `${questionFontSize}rem`;
                
                // Show results screen
                startScreen.style.display = 'none';
                quizScreen.style.display = 'none';
                resultsScreen.style.display = 'block';
                
                // Generate answer list with proper font sizes
                answersContainer.innerHTML = '';
                selectedQuestions.forEach((question, index) => {
                    const answerItem = document.createElement('div');
                    answerItem.className = 'answer-item';
                    
                    // Question text
                    const questionText = document.createElement('div');
                    questionText.className = 'fw-bold mb-2';
                    questionText.style.fontSize = `${questionFontSize}rem`;
                    questionText.style.lineHeight = `${questionFontSize + 0.5}rem`;
                    questionText.textContent = `${index + 1}. ${currentLanguage === 'malayalam' && question.malayalam_question ? question.malayalam_question : question.question}`;
                    answerItem.appendChild(questionText);
                    
                    // Options (show correct answer)
                    for (let i = 1; i <= 4; i++) {
                        const optionDiv = document.createElement('div');
                        optionDiv.className = 'ms-3';
                        optionDiv.style.fontSize = `${optionFontSize}rem`;
                        optionDiv.style.lineHeight = `${optionFontSize + 0.3}rem`;
                        
                        let optionText;
                        if (currentLanguage === 'malayalam' && question[`malayalam_option${i}`]) {
                            optionText = question[`malayalam_option${i}`];
                        } else {
                            optionText = question[`option${i}`];
                        }
                        
                        optionDiv.textContent = `${optionLetters[i-1]}. ${optionText}`;
                        
                        // Highlight correct answer
                        if (question[`option${i}`] === question.answer) {
                            optionDiv.style.fontWeight = 'bold';
                            optionDiv.style.color = 'green';
                        }
                        
                        answerItem.appendChild(optionDiv);
                    }
                    
                    answersContainer.appendChild(answerItem);
                });
                
                // Scroll to top of results
                window.scrollTo(0, 0);
            }

            // Restart the quiz
            restartBtn.addEventListener('click', function() {
                // Clear localStorage
                localStorage.removeItem('quizLanguage');
                
                // Reset to start screen
                startScreen.style.display = 'flex';
                quizScreen.style.display = 'none';
                resultsScreen.style.display = 'none';
                chapterSelection.style.display = 'none';
                questionCountSelection.style.display = 'none';
                startQuizBtn.style.display = 'none';
                
                // Reset selections
                selectedSubject = null;
                questionsPerChapter = 0;
                selectedChapters = [];
                
                // Reset language to default
                currentLanguage = 'english';
                updateLanguageButtonText();
                
                // Reset question count buttons
                questionCountButtons.forEach(btn => btn.classList.remove('active'));
            });

            // Event listeners
            fontSizeSlider.addEventListener('input', updateFontSizes);
            languageToggle.addEventListener('click', toggleLanguage);
            resultsLanguageToggle.addEventListener('click', toggleResultsLanguage);
            nextBtn.addEventListener('click', nextQuestion);
            prevBtn.addEventListener('click', prevQuestion);
            revealBtn.addEventListener('click', revealAnswer);

            // Apply initial font sizes
            applyFontSizes();
        });
    </script>
</body>
</html>